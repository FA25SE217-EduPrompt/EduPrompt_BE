CREATE TABLE subjects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT,
    description TEXT,
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now()
);

-- Grade Levels (Khối lớp: 10, 11, 12)
CREATE TABLE grade_levels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    subject_id UUID,
    level INT,
    description TEXT,
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    CONSTRAINT fk_grade_subject FOREIGN KEY (subject_id)
            REFERENCES subjects(id) ON DELETE CASCADE
);

-- Semesters (Học kỳ)
CREATE TABLE semesters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    grade_level_id UUID,
    semester_number INT, -- 1 or 2 (HK1, HK2)
    name TEXT,
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    CONSTRAINT fk_semesters_grade_level FOREIGN KEY (grade_level_id)
        REFERENCES grade_levels(id) ON DELETE CASCADE
);

-- Chapters (Chương)
CREATE TABLE chapters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    semester_id UUID,
    chapter_number INT,
    name TEXT,
    description TEXT,
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    CONSTRAINT fk_chapters_semester FOREIGN KEY (semester_id)
        REFERENCES semesters(id) ON DELETE CASCADE
);

-- Lessons (Bài học)
CREATE TABLE lessons (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    chapter_id UUID,
    lesson_number INT,
    name TEXT,
    description TEXT,
    content TEXT,
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    CONSTRAINT fk_lessons_chapter FOREIGN KEY (chapter_id)
        REFERENCES chapters(id) ON DELETE CASCADE
);

alter table prompts
add column lesson_id uuid;

alter table prompts
add constraint fk_prompts_lesson
foreign key (lesson_id)
references lessons (id)
on delete set null;