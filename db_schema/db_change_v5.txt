
-- Add status and error tracking to PromptUsage table
ALTER TABLE prompt_usage
ADD COLUMN status VARCHAR(20) DEFAULT 'COMPLETED',
ADD COLUMN error_message TEXT,
ADD COLUMN updated_at TIMESTAMP,
ADD INDEX idx_status_created (status, created_at);

-- Update existing records to have COMPLETED status
UPDATE prompt_usage SET status = 'COMPLETED' WHERE status IS NULL;

CREATE INDEX idx_prompt_usage_idempotency ON prompt_usage(idempotency_key);
CREATE INDEX idx_prompt_usage_user_created ON prompt_usage(user_id, created_at DESC);